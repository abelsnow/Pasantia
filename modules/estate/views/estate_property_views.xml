<?xml version="1.0" encoding="utf-8"?>
<odoo>

<record id="estate_property_action" model="ir.actions.act_window">
    <field name="name">Estate Properties</field>
    <field name="res_model">estate.property</field>
    <field name="view_mode">kanban,tree,form</field>
    <field name="context">{'search_default_available': 1} </field>
    <field name="context">{'default_group_by': 'type_id'} </field>
</record>

<record id="estate_property_list_view" model="ir.ui.view">
    <field name="name">estate.property.tree</field>
    <field name="model">estate.property</field>
    <field name="arch" type="xml">
            <tree string="Estate Properties" decoration-success= "state == 'offer accepted' or state == 'offer received'" 
            decoration-bf= "state == 'offer accepted'"
            decoration-muted= "state == 'sold'"> 
                <field name="name" string= 'Property Name'/>
                <field name="description" string= 'Description'/>
                <field name="postcode" string= 'Postcode'/>
                <field name="date_availability" string= 'Date Availability' optional= "hide"/>
                <field name="expected_price" string= 'Expected Price'/>
                <field name="selling_price" string= 'Selling Price'/>
                <field name="bedrooms" string= 'Bedrooms'/>
                <field name="living_area" string= 'Living Area'/>
                <field name="facades" string= 'Facades'/>
                <field name="garage" string= 'Garage'/>
                <field name="garden" string= 'Garden'/>
                <field name="garden_area" string= 'Garden Area'/>
                <field name="garden_orientation" string= 'Garden Orientation'/>
                <field name="active" string= 'Active'/>
                <field name="state" string= 'State' widget='statusbar' options="{'clickable' :'true'}"/>
            </tree>
        </field>
    </record>

    <record id="estate_property_view_form" model="ir.ui.view">
        <field name="name">estate_property.view.form</field>
        <field name="model">estate.property</field>
        <field name="arch" type="xml">
            <form string="Estate Property">
                <header>
                
                <button name="action_cancel" type="object" string= "Cancel" invisible="state == 'sold' or state == 'canceled'"/>
                <button name="action_sold" type="object" string= "Sold" invisible="state == 'sold' or state == 'canceled'"/>
                <field name="state" string='State' widget="statusbar" options="{'clickable': 'true'}"/>
                </header>
                <sheet>
                
                    <notebook>
                        <page string="Property Info">
                            <group name="name" string="Buyers/Sellers">
                                <field name="salesperson_id"/>
                                <field name="buyer_id" />
                            </group>
                            <group>
                                <group name="name" string="Informacion basica">
                                    <field name="name" string= 'Nombre de la propiedad'/>
                                    <field name="description" string= 'Descripcion'/>
                                    <field name="postcode" string= 'Codigo postal'/>
                                </group>

                                <group name="name" string="Detalles de los precios">
                                    <field name="expected_price" string= 'Precio Esperado'/>
                                    <field name="selling_price" string= 'Precio a la venta'/> 
                                    <field name="best_price" string= 'Mejor Oferta'/>
                                </group>
                                <group name="name" string="Property Availability">
                                    <field name="date_availability" string= 'Date Availability' optional= "hide"/>
                                    <field name="active" string='Active'/>
                                </group>
                                <group name="Tags/Type" string="Tags/Type">
                                    <field name="tag_ids" widget='many2many_tags' options="{'colors': {'0': 'red', '1': 'blue', '2': 'green'}}" />
                                    <field name="type_id" widget="many2one"/>                        
                                </group>
                            </group>
                        </page>
                        <page string="Offers">
                            <group name="name" string="Ofertas">
                                <field name="offer_ids" widget="many2many" readonly="state in ['offer accepted', 'sold', 'canceled']"/>
                            </group>
                        </page>
                        <page string="Rooms/Garden info">
                            <group name="name" string="Informacion de Habitaciones">
                                    <field name="bedrooms" string= 'Habitaciones'/>
                                    <field name="living_area" string= 'Living Area'/>
                                    <field name="facades" string= 'Facades'/>
                                    <field name="garage" string= 'Garage'/>
                                </group>
                      
                                <group name="name" string="Informacion del Patio">
                                    <field name="garden" string='Patio'/>
                                    <field name="garden_area" string='Area del patio' invisible="not garden"/>
                                    <field name="garden_orientation" string='Orientacion del Patio' invisible = "not garden"/>
                                    <field name="total_area" string= 'Area total'/>
                                </group>
                        </page>
                    </notebook>
                    
                </sheet>
            </form>
        </field>
    </record>

    <record id="estate_property_view_search" model="ir.ui.view">
        <field name="name">estate_property.view.search</field>
        <field name="model">estate.property</field>
        <field name="arch" type="xml">
            <search string="Test">
                <field name='name'/>
                <field name="living_area" filter_domain="[('living_area','>=', self)]"/>
                <filter name="available" string="Available" domain="[('active', '=', True)]"/>
                <filter name="inactive" string="Inactive" domain="[('active', '=', False)]"/>
            </search>
        </field>
    </record>

<record id="tag_ids_action" model="ir.actions.act_window">
    <field name="name">Tags</field>
    <field name="res_model">estate.property.tag</field>
    <field name="view_mode">tree,form</field>
</record>

<record id="type_id_action" model="ir.actions.act_window">
    <field name="name">Types</field>
    <field name="res_model">estate.property.type</field>
    <field name="view_mode">tree,form</field>
</record>

    <record id="tag_ids_view_tree" model="ir.ui.view">
        <field name="name">estate_property_tag.view.tree</field>
        <field name="model">estate.property.tag</field>
        <field name="arch" type="xml">
            <tree>
                <field name="name"/>
            </tree>
        </field>
    </record>

    <record id="type_id_view_tree" model="ir.ui.view">
        <field name="name">estate_property_type.view.tree</field>
        <field name="model">estate.property.type</field>
        <field name="arch" type="xml">
            <tree>
                <field name="name"/>
            </tree>
        </field>
    </record>

    <record id="estate_property_offer_view_tree" model="ir.ui.view">
        <field name="name">estate.property.offer.view.tree</field>
        <field name="model">estate.property.offer</field>
        <field name="arch" type="xml">
            <tree string="Offers" editable="bottom" decoration-danger="status == 'refused'"
            decoration-success= "status == 'accepted'">
                <field name="price"/>
                <field name="status" invisible= "true"/>
                <field name="partner_id"/>
                <field name="property_id"/>
                <field name="validity" />
                <field name="date_deadline" />
                <button name="action_accepted" type="object" string="Accept" icon='fa-check' invisible="status == 'accepted' or status == 'refused' "/>
                <button name="action_refuse" type="object" string="Refuse" icon='fa-times' invisible="status == 'accepted' or status== 'refused' "/>
            </tree>
        </field>
    </record>


    <record id="estate_property_offer_action" model="ir.actions.act_window">
        <field name="name"></field>
        <field name="res_model">estate.property.offer</field>
        <field name="view_mode">tree,form</field>
        <field name="domain">[('estate_property_type_id', '=', 'active_id.active')]</field>
        <field name="context">{'default_property_type_id': active_id.active}</field>

    </record>

    <record id="view_estate_property_type_view_form" model="ir.ui.view">
    <field name="name">estate.property.type.view.form</field>
    <field name="model">estate.property.type</field>
    <field name="arch" type="xml">
        <form string="Property Type">
            <sheet>
                <group>
                    <field name="name"/>
                </group>
                <group>
                    <field name="estate_property_id">
                        <tree editable="bottom">
                            <field name="name"/>
                            <field name="expected_price"/>
                            <field name="state"/>
                        </tree>
                    </field>
                </group>
            </sheet>
            <div class="o_stat_buttons">
                <button action="estate_property_type_action" string="action_view_offers" name="action_view_offers" type="object" class="o_stat_button" icon='fa-money'>
                    <field name="offer_ids" widget="statinfo" string= 'Offers'/>
                </button>
            </div>
            <notebook>
                <page name="name" string="Types">
                    <field name="estate_property_id" />
                </page>
                <page string= "Offers">
                    <field name="offer_ids" />
                </page>
            </notebook>
        </form>
    </field>
    </record>

    <record id="estate_property_type_view_tree" model="ir.ui.view">
        <field name="name">estate.property.type.view.tree</field>
        <field name="model">estate.property.type</field>
        <field name="arch" type="xml">
            <tree string="Property Type">

                <field name="sequence" widget="handle"/>
                <field name="name"/>

            </tree>
        </field>
    </record>

    <record id="estate_property_type_action" model="ir.actions.act_window">
        <field name="name">Estate Property Type action</field>
        <field name="res_model">estate.property.type</field>
        <field name="view_mode">tree,form</field>

    </record>
    <record id="estate_property_tag_view_tree" model="ir.ui.view">
        <field name="name">estate.property.tag.view.tree</field>
        <field name="model">estate.property.tag</field>
        <field name="arch" type="xml">
            <tree string="Property Tags" editable='bottom'>
                <field name="name" />
                <field name="color"/>
            </tree>
        </field>
    </record>

<record id="estate_property_rule_salesperson_id" model="ir.rule">
        <field name="name">Only see own properties</field>
        <field name="model_id" ref="estate.model_estate_property"/>
        <field name="domain_force">[('salesperson_id', '=', user.id)]</field>
        <field name="groups" eval="[(4, ref('base.group_user'))]"/>
    </record>

    <record id="view_users_form" model="ir.ui.view">
        <field name="name">res.users.form.inherit</field>
        <field name="model">res.users</field>
        <field name="inherit_id" ref="base.view_users_form"/>
        <field name="arch" type="xml">
            <notebook position="inside">
                <page string="Properties">
                    <field name="property_ids" widget="one2many_list" readonly="1">
                        <tree>
                            <field name="name"/>
                            <field name="postcode"/>
                            <field name="expected_price"/>
                            <field name="state"/>
                        </tree>
                    </field>
                </page>
            </notebook>
        </field>
    </record>

<record id="estate_property_view_kanban" model="ir.ui.view">
    <field name="name">estate.property.kanban.view</field>
    <field name="model">estate.property</field>
    <field name="arch" type="xml">
        <kanban default_group_by="type_id">

            <group name="type_id" string="Property Type">
                <field name="type_id" />
            </group>
            <field name="state" />
            <field name="name"/>
            <field name="expected_price"/>
            <field name="best_price"/>
            <field name="selling_price"/>
            <field name="tag_ids" />


            <templates>
                <t t-name="kanban-box">
                    <div class="oe_kanban_global_click">
                        <div class = "oe_kanban_card">
                            <div class = "o_kanban_record_title">
                                <strong>
                                    <field name="name" />
                                </strong>
                            </div>

                            <div class= "o_kanban_record_body">
                                <div>
                                    <strong>Expected Price : </strong> <field name="expected_price" />
                                </div>
                                <t t-if="record.state.raw_value == 'offer received'">
                                    <div>
                                        <strong>Best Price : </strong> <field name="best_price" />
                                    </div>
                                </t>
                                <t t-if="record.state.raw_value == 'offer accepted'">
                                    <div>
                                        <strong>Selling Price : </strong> <field name="selling_price" />
                                    </div>
                                </t>
                                <div>
                                    <strong> Tags :</strong>
                                    <field name="tag_ids" widget="many2many_tags" />
                                </div>
                            </div>
                        </div>
                    </div>
                </t>
            </templates>
        </kanban>
    </field>
</record>

</odoo>
